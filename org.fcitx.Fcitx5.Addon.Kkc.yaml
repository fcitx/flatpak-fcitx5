app-id: org.fcitx.Fcitx5.Addon.Kkc
branch: master
runtime: org.fcitx.Fcitx5
runtime-version: master
sdk: org.kde.Sdk//5.15-22.08
build-extension: true
appstream-compose: false
separate-locales: false
build-options:
  prefix: /app/addons/Kkc
  prepend-path: /app/addons/Kkc/bin
  prepend-pkg-config-path: /app/addons/Kkc/lib/pkgconfig
  cflags: -I/app/addons/Kkc/include

cleanup:
  - /bin
  - /include
  - /lib/pkgconfig
  - "/lib/python*"
  - "/lib/vala*"
  - "/lib/gir*"
  - "/share/vala*"
  - "/share/gir*"
  - /share/intltool
  - "*.la"

modules:
  - name: gnome-common
    rm-configure: true
    config-opts:
      - --enable-maintainer-mode
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gnome-common/3.18/gnome-common-3.18.0.tar.xz
        sha256: 22569e370ae755e04527b76328befc4c73b62bfd4a572499fde116b8318af8cf
    cleanup: ['*']
  - name: intltool
    sources:
      - type: archive
        url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
        md5: 12e517cac2b57a0121cda351570f1e63
  - modules/graphviz.yaml
  - modules/vala.yaml
  - modules/libgee.yaml
  - modules/marisa.yaml
  - name: libkkc
    sources:
      - type: archive
        url: https://github.com/ueno/libkkc/releases/download/v0.3.5/libkkc-0.3.5.tar.gz
        sha512: f611c3104a22ad38af29746870849d8937b6af2a7fee0952cc25f36ef845b5617a192df7ca63ff2a507384f7a6a13c9c1b4fa3b9a34f3f041bee8793d04b9236
      - type: patch
        path: libkkc-python3.patch
    build-options:
      env:
        ACLOCAL_PATH: /app/addons/Kkc/share/aclocal
        VALAFLAGS: --vapidir /app/addons/Kkc/share/vala/vapi
        XDG_DATA_DIRS: /app/addons/Kkc/share:/app/share:/usr/share
        PYTHONPATH: /app/addons/Kkc/lib/python3.9/site-packages
      prepend-ld-library-path: /app/addons/Kkc/lib
    make-args:
      - V=1
  - name: libkkc-data
    sources:
      - type: archive
        url: https://github.com/ueno/libkkc/releases/download/v0.3.5/libkkc-data-0.2.7.tar.xz
        sha256: 9e678755a030043da68e37a4049aa296c296869ff1fb9e6c70026b2541595b99
      - type: patch
        path: libkkc-python3.patch
        strip-components: 4
    build-options:
      env:
        PYTHONPATH: /app/addons/Kkc/lib/python3.9/site-packages
      prepend-ld-library-path: /app/addons/Kkc/lib
  - name: skk-jisyo
    buildsystem: simple
    build-commands:
      - install -Dm644 SKK-JISYO.* -t ${FLATPAK_DEST}/share/skk/
    sources:
      - type: git
        url: https://github.com/skk-dev/dict.git
        branch: master
  - name: fcitx5-kkc
    buildsystem: cmake-ninja
    config-opts:
      - -DSKK_DEFAULT_PATH=/app/addons/Skk/share/skk/SKK-JISYO.L
    sources:
      - type: git
        url: https://github.com/fcitx/fcitx5-kkc
    post-install:
      - appstream-compose --basename=org.fcitx.Fcitx5.Addon.Kkc --prefix=${FLATPAK_DEST} --origin=flatpak org.fcitx.Fcitx5.Addon.Kkc
